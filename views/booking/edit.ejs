<!DOCTYPE html>
<html>
<head>
    <title>Edit Booking</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 40px; }
        .back-btn { color: white; text-decoration: none; margin-right: 15px; }
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .error { background: #fee; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 20px; }
        .section-title { color: #667eea; font-size: 1.4em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full { grid-column: 1 / -1; }
        label { font-weight: 600; margin-bottom: 8px; color: #555; }
        input, select, textarea { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; min-height: 80px; }
        .calculated-field { background: #f8f9fa; border: 2px dashed #ccc; }
        .btn-group { display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; text-decoration: none; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-secondary { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <a href="/booking/<%= booking.id %>" class="back-btn">← Back</a>
        <h1 style="display:inline-block;margin-left:15px">Edit Booking - <%= booking.bookingNo %></h1>
    </div>
    
    <div class="container">
        <div class="form-card">
            <% if (error) { %>
                <div class="error"><%= error %></div>
            <% } %>
            
            <form method="POST" action="/booking/<%= booking.id %>/edit" id="bookingForm">
                <!-- Customer Selection -->
                <h2 class="section-title">Customer Information</h2>
                <div class="form-grid">
                    <div class="form-group full">
                        <label>Customer *</label>
                        <select name="customerId" required>
                            <option value="">Select Customer</option>
                            <% customers.forEach(customer => { %>
                                <option value="<%= customer.id %>" <%= booking.customerId == customer.id ? 'selected' : '' %>>
                                    <%= customer.applicantName %> - <%= customer.mobileNo %> (<%= customer.customerNo %>)
                                </option>
                            <% }); %>
                        </select>
                    </div>
                </div>
                
                <!-- Property Details -->
                <h2 class="section-title">Property Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Project *</label>
                        <select name="projectId" required>
                            <% projects.forEach(project => { %>
                                <option value="<%= project.id %>" <%= booking.projectId == project.id ? 'selected' : '' %>>
                                    <%= project.projectName %>
                                </option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Plot Number *</label>
                        <input type="text" name="plotNo" value="<%= booking.plotNo %>" required>
                    </div>
                    <div class="form-group">
                        <label>Area (sq.ft.) *</label>
                        <input type="number" name="area" id="area" value="<%= parseFloat(booking.area) %>" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Rate per sq.ft. (₹) *</label>
                        <input type="number" name="rate" id="rate" value="<%= parseFloat(booking.rate) %>" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>PLC (₹)</label>
                        <input type="number" name="plc" id="plc" value="<%= parseFloat(booking.plc) %>" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Discount (₹)</label>
                        <input type="number" name="discount" id="discount" value="<%= parseFloat(booking.discount) %>" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Effective Rate (₹)</label>
                        <input type="number" id="effectiveRate" value="<%= parseFloat(booking.effectiveRate) %>" class="calculated-field" readonly>
                    </div>
                    <div class="form-group">
                        <label>Total Amount (₹)</label>
                        <input type="number" id="totalAmount" value="<%= parseFloat(booking.totalAmount) %>" class="calculated-field" readonly>
                    </div>
                    <div class="form-group full">
                        <label>Legal Details</label>
                        <textarea name="legalDetails"><%= booking.legalDetails || '' %></textarea>
                    </div>
                </div>
                
                <!-- Payment Details -->
                <h2 class="section-title">Booking Payment Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Booking Amount (₹) *</label>
                        <input type="number" name="bookingAmount" value="<%= parseFloat(booking.bookingAmount) %>" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Payment Mode *</label>
                        <select name="paymentMode" required>
                            <option value="Cash" <%= booking.paymentMode === 'Cash' ? 'selected' : '' %>>Cash</option>
                            <option value="Cheque" <%= booking.paymentMode === 'Cheque' ? 'selected' : '' %>>Cheque</option>
                            <option value="Online Transfer" <%= booking.paymentMode === 'Online Transfer' ? 'selected' : '' %>>Online Transfer</option>
                            <option value="UPI" <%= booking.paymentMode === 'UPI' ? 'selected' : '' %>>UPI</option>
                            <option value="Card" <%= booking.paymentMode === 'Card' ? 'selected' : '' %>>Card</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Transaction Number</label>
                        <input type="text" name="transactionNo" value="<%= booking.transactionNo || '' %>">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="status">
                            <option value="Active" <%= booking.status === 'Active' ? 'selected' : '' %>>Active</option>
                            <option value="Completed" <%= booking.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                            <option value="Cancelled" <%= booking.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group full">
                        <label>Remarks</label>
                        <textarea name="remarks"><%= booking.remarks || '' %></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <a href="/booking/<%= booking.id %>" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Update Booking</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        const area = document.getElementById('area');
        const rate = document.getElementById('rate');
        const plc = document.getElementById('plc');
        const discount = document.getElementById('discount');
        const effectiveRate = document.getElementById('effectiveRate');
        const totalAmount = document.getElementById('totalAmount');
        
        function calculateAmounts() {
            const areaVal = parseFloat(area.value) || 0;
            const rateVal = parseFloat(rate.value) || 0;
            const plcVal = parseFloat(plc.value) || 0;
            const discountVal = parseFloat(discount.value) || 0;
            
            const effRate = rateVal - discountVal;
            const total = (areaVal * effRate) + plcVal;
            
            effectiveRate.value = effRate.toFixed(2);
            totalAmount.value = total.toFixed(2);
        }
        
        area.addEventListener('input', calculateAmounts);
        rate.addEventListener('input', calculateAmounts);
        plc.addEventListener('input', calculateAmounts);
        discount.addEventListener('input', calculateAmounts);
        
        calculateAmounts();
    </script>
</body>
</html>
