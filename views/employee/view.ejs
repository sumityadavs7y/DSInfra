<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee <%= employee.employeeNo %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">
    <%- include('../partials/page-header', { 
        title: 'Employee Details', 
        icon: 'bi-person-badge', 
        backUrl: '/employee', 
        actionUrl: '/employee/' + employee.id + '/edit', 
        actionText: 'Edit', 
        actionIcon: 'bi-pencil'
    }) %>

    <div class="container my-4">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                <!-- Employee Info Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h3 class="h4 mb-1 text-primary"><%= employee.firstName %> <%= employee.lastName %></h3>
                                <small class="text-muted"><%= employee.employeeNo %></small>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <% if (employee.isDeleted) { %>
                                    <span class="badge bg-danger px-3 py-2">Deleted</span>
                                <% } %>
                                <span class="badge bg-<%= employee.status === 'Active' ? 'success' : employee.status === 'On Leave' ? 'warning' : 'danger' %> px-3 py-2">
                                    <%= employee.status %>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-4">
                            <!-- Personal Details -->
                            <div class="col-12">
                                <h5 class="text-primary mb-3"><i class="bi bi-person"></i> Personal Details</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="text-muted small">Email</label>
                                        <p class="h6"><%= employee.email %></p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Phone</label>
                                        <p class="h6"><%= employee.phone %></p>
                                    </div>
                                    <% if (employee.alternatePhone) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Alternate Phone</label>
                                        <p class="h6"><%= employee.alternatePhone %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.dateOfBirth) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Date of Birth</label>
                                        <p class="h6"><%= new Date(employee.dateOfBirth).toLocaleDateString('en-IN') %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.gender) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Gender</label>
                                        <p class="h6"><%= employee.gender %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.address) { %>
                                    <div class="col-12">
                                        <label class="text-muted small">Address</label>
                                        <p class="h6"><%= employee.address %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.city || employee.state) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">City, State</label>
                                        <p class="h6"><%= employee.city %><% if (employee.city && employee.state) { %>, <% } %><%= employee.state %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.pincode) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Pincode</label>
                                        <p class="h6"><%= employee.pincode %></p>
                                    </div>
                                    <% } %>
                                </div>
                            </div>

                            <hr>

                            <!-- Employment Details -->
                            <div class="col-12">
                                <h5 class="text-success mb-3"><i class="bi bi-briefcase"></i> Employment Details</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="text-muted small">Department</label>
                                        <p class="h6"><span class="badge bg-info"><%= employee.department %></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Designation</label>
                                        <p class="h6"><%= employee.designation %></p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Employment Type</label>
                                        <p class="h6"><span class="badge bg-primary"><%= employee.employmentType %></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Joining Date</label>
                                        <p class="h6"><%= new Date(employee.joiningDate).toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Basic Salary</label>
                                        <p class="h6 text-success fw-bold">₹<%= parseFloat(employee.basicSalary).toLocaleString('en-IN') %>/month</p>
                                    </div>
                                    <% if (employee.exitDate) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Exit Date</label>
                                        <p class="h6 text-danger"><%= new Date(employee.exitDate).toLocaleDateString('en-IN') %></p>
                                    </div>
                                    <% } %>
                                </div>
                            </div>

                            <% if (employee.aadhaarNumber || employee.panNumber || employee.bankName) { %>
                            <hr>

                            <!-- Bank & IDs -->
                            <div class="col-12">
                                <h5 class="text-warning mb-3"><i class="bi bi-bank"></i> Bank & IDs</h5>
                                <div class="row g-3">
                                    <% if (employee.aadhaarNumber) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Aadhaar Number</label>
                                        <p class="h6"><%= employee.aadhaarNumber %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.panNumber) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">PAN Number</label>
                                        <p class="h6"><%= employee.panNumber %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.bankName) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Bank Name</label>
                                        <p class="h6"><%= employee.bankName %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.accountNumber) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">Account Number</label>
                                        <p class="h6"><%= employee.accountNumber %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.ifscCode) { %>
                                    <div class="col-md-6">
                                        <label class="text-muted small">IFSC Code</label>
                                        <p class="h6"><%= employee.ifscCode %></p>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                            <% } %>

                            <% if (employee.emergencyContactName) { %>
                            <hr>

                            <!-- Emergency Contact -->
                            <div class="col-12">
                                <h5 class="text-danger mb-3"><i class="bi bi-telephone-fill"></i> Emergency Contact</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="text-muted small">Contact Name</label>
                                        <p class="h6"><%= employee.emergencyContactName %></p>
                                    </div>
                                    <% if (employee.emergencyContactPhone) { %>
                                    <div class="col-md-4">
                                        <label class="text-muted small">Contact Phone</label>
                                        <p class="h6"><%= employee.emergencyContactPhone %></p>
                                    </div>
                                    <% } %>
                                    <% if (employee.emergencyContactRelation) { %>
                                    <div class="col-md-4">
                                        <label class="text-muted small">Relation</label>
                                        <p class="h6"><%= employee.emergencyContactRelation %></p>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                            <% } %>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0"><i class="bi bi-lightning-fill"></i> Quick Actions</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <div class="col-6 col-md-3">
                                    <a href="/employee/<%= employee.id %>/attendance" class="btn btn-outline-primary w-100">
                                        <i class="bi bi-calendar-check"></i><br>Attendance
                                    </a>
                                </div>
                                <div class="col-6 col-md-3">
                                    <a href="/employee/<%= employee.id %>/salary" class="btn btn-outline-success w-100">
                                        <i class="bi bi-cash-stack"></i><br>Salary
                                    </a>
                                </div>
                                <div class="col-6 col-md-3">
                                    <a href="/employee/<%= employee.id %>/documents" class="btn btn-outline-warning w-100">
                                        <i class="bi bi-file-earmark-text"></i><br>Documents
                                    </a>
                                </div>
                                <div class="col-6 col-md-3">
                                    <% if (employee.isDeleted) { %>
                                    <form method="POST" action="/employee/<%= employee.id %>/restore" class="d-inline">
                                        <button type="submit" class="btn btn-outline-info w-100">
                                            <i class="bi bi-arrow-counterclockwise"></i><br>Restore
                                        </button>
                                    </form>
                                    <% } else { %>
                                    <button class="btn btn-outline-danger w-100" onclick="deleteEmployee()">
                                        <i class="bi bi-trash"></i><br>Delete
                                    </button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Attendance -->
                    <% if (recentAttendance.length > 0) { %>
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Recent Attendance (Last 30 Days)</h5>
                                <a href="/employee/<%= employee.id %>/attendance" class="btn btn-sm btn-primary">
                                    View All
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Check In</th>
                                            <th>Check Out</th>
                                            <th>Hours</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% recentAttendance.slice(0, 10).forEach(att => { %>
                                        <tr>
                                            <td><%= new Date(att.date).toLocaleDateString('en-IN') %></td>
                                            <td><%= att.checkIn || '-' %></td>
                                            <td><%= att.checkOut || '-' %></td>
                                            <td><%= att.workingHours || 0 %>h</td>
                                            <td>
                                                <span class="badge bg-<%= att.status === 'Present' ? 'success' : att.status === 'Absent' ? 'danger' : 'warning' %>">
                                                    <%= att.status %>
                                                </span>
                                            </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <% } %>

                    <!-- Recent Salaries -->
                    <% if (recentSalaries.length > 0) { %>
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-cash-stack"></i> Recent Salary Records</h5>
                                <a href="/employee/<%= employee.id %>/salary" class="btn btn-sm btn-success">
                                    View All
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Month/Year</th>
                                            <th>Gross</th>
                                            <th>Deductions</th>
                                            <th>Net Salary</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% recentSalaries.forEach(salary => { %>
                                        <tr>
                                            <td><%= ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][salary.month - 1] %> <%= salary.year %></td>
                                            <td>₹<%= parseFloat(salary.grossSalary).toLocaleString('en-IN') %></td>
                                            <td class="text-danger">-₹<%= parseFloat(salary.totalDeductions).toLocaleString('en-IN') %></td>
                                            <td class="fw-bold text-success">₹<%= parseFloat(salary.netSalary).toLocaleString('en-IN') %></td>
                                            <td>
                                                <span class="badge bg-<%= salary.paymentStatus === 'Paid' ? 'success' : salary.paymentStatus === 'Pending' ? 'warning' : 'secondary' %>">
                                                    <%= salary.paymentStatus %>
                                                </span>
                                            </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <% } %>

                    <!-- Documents -->
                    <% if (employee.documents && employee.documents.length > 0) { %>
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Documents</h5>
                                <a href="/employee/<%= employee.id %>/documents" class="btn btn-sm btn-warning">
                                    Manage Documents
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row g-2">
                                <% employee.documents.forEach(doc => { %>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center p-2 border rounded">
                                        <i class="bi bi-file-earmark-pdf fs-3 text-danger me-2"></i>
                                        <div class="flex-grow-1">
                                            <div class="fw-bold"><%= doc.documentType %></div>
                                            <small class="text-muted"><%= doc.documentName %></small>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function deleteEmployee() {
            if (confirm('⚠️ WARNING: This will permanently delete this employee and ALL related data including:\n\n• All Attendance Records\n• All Salary Records\n• All Documents\n\nThis action cannot be undone. Are you sure you want to continue?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/employee/<%= employee.id %>/delete';
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>


